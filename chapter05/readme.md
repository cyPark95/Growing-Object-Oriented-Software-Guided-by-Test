# 5장 테스트 주도 개발 주기의 유지

## 5.1 각 기능을 인수 테스트로 시작하라

- 신기능 개발은 실패하는 인수 테스트를 작성하는 것부터 시작한다.
    - 시스템이 아직 해당 기능을 갖추지 못했다는 사실을 보여준다.
    - 기능이 완성되어 가는 진행 상황을 반영한다.
- 인수 테스트를 작성할 때는 기반 기술 용어가 이닌 응용 도메인 용어를 사용해야 한다.
    - 시스템의 업무적 목적과 행위를 이해하는 데 도움이 된다.
    - 구현에 관한 초기 가정에 얽매이지 않는다.
    - 구현 세부 사항에 종속되지 않고, 테스트가 단순하게 유지된다.
    - 시스템의 기술 기반 구조가 바뀌어도 인수 테스트를 보호할 수 있다.
- 인수 테스트의 이점
    - 달성하고자 하는 목표가 명확해진다.
    - 자동으로 검증 가능한 형태로 요구사항을 표현하면, 드러나지 않은 가정을 밝히는 데 도움이 된다.
    - 실패하는 테스트는 요구 사항을 충족하는 데 필요한 만큼의 기능만 구현하는 데 집중할 수 있어 기능을 완성할 가능성이 높아진다.
    - 테스트를 통해 시스템을 사용자 관점에서 바라보게 되어 구현자 관점에서 예상하지 못했던 사용자가 필요로 하는 것을 이해하게 된다.
- 단위 테스트
    - 단위 테스트는 객체나 작은 객체 집합을 격리된 상태에서 검증한다.
    - 클래스의 올바른 동작을 보장하지만, 시스템 전체에서 조화롭게 동작하는지에 대해서는 보장하지 않는다.
- 인수 테스트는 단위 테스트를 거친 객체를 대상으로 통합 테스트를 수행할 뿐 아니라 프로젝트를 앞으로 나아가게 하는 지표가 된다.

## 5.2 회귀를 포착하는 테스트와 진행 상황을 측정하는 테스트를 분리하라

- 실패하는 인수 테스트는 완료되지 않은 작업을 나타내며, 성공으로 전환되는 순간 기능의 완성을 의미한다.
- 정기적인 인수 테스트 통과 주기는 중첩된 피드백 고리를 지속적으로 구동하는 엔진 역할을 한다.
- 회귀 테스트 (Regression Test)
    - 이미 구현된 기능이 여전히 올바르게 동작하는지 검증한다.
    - 회귀 테스트가 실패한다는 것은 기존 기능이 깨졌다는 의미로, 다시는 실패해서는 안 된다.
- 테스트의 다양한 역할을 반영할 수 있도록 테스트 스위트를 구성해야 한다.
    - 단위 테스트와 통합 테스트는 빠르게 실행되고, 항상 통과해야 한다.
    - 완성된 기능에 대한 인수 테스트는 실행하는 데 오랜 시간이 걸리더라도 반드시 통과해야 한다.
    - 새로운 인수 테스트는 진행 중인 기능을 나타내며, 기능이 완료되기 전까지는 실패 상태를 유지한다.
- 요구사항이 변경된 경우
    - 영향을 받은 인수 테스트를 회귀 테스트 그룹에서 진행 중인 테스트 그룹으로 이동시킨다.
    - 새로운 요구사항에 맞게 테스트를 수정한다.
    - 다시 테스트를 통과시키도록 시스템을 변경한다.

## 5.3 테스트를 가장 간단한 성공 케이스로 시작하라

- 상투적인 테스트 케이스는 충분한 피드백을 주지 못한다.
    - 이런 테스트는 시스템의 가치나 방향성에 대한 유용한 피드백을 제공하지 못한다.
- 가장 단순한 성공 케이스부터 시작해야 한다.
    - 솔루션의 기본 구조를 명확히 이해할 수 있고, 더 좋은 아이디어가 떠오른다.
    - 이 과정에서 발생한 실패 케이스와 이후 다뤄야 할 성공 케이스의 우선순위를 판단할 수 있다.

## 5.4 읽고 싶어 할 테스트를 작성하라

- 테스트는 가능한 한 명확하게 표현해야 한다.
- 테스트를 작성할 때는 내용에만 집중해야 한다.
    - 아직 코드가 컴파일되지 않거나 실행되지 않을 거라는 사실은 무시하고 의도를 표현하는데 집중해야 한다.
    - 보조 역할의 코드는 이미 존재한다고 가정하고 작성한다.
- 잘 읽히는 테스트는 기반 구조를 이끌어낸다.
    - 테스트를 통과시키기 위해 필요한 보조 코드가 드러난다.
    - 테스트를 실행했을 때 예상대로 실패한다면 보조적인 역할을 하는 코드를 충분히 구현했다는 사실을 알게 된다.

## 5.5 테스트가 실패하는 것을 지켜보라

- 실패하는 테스트가 예상과 다른 형태로 실패한다면 잘못 이해했거나 코드가 완성되지 않았다는 것을 의미한다.
- ‘적당한 실패’의 진단 정보는 문제의 원인을 명확하게 표시해야 한다.
    - 오류 메시지가 모호하다면, 테스트 코드를 조정하고 재실행하여 관련된 문제로 올바르게 이끌도록 작성해야 한다.

<img width="400" height="300" alt="Image" src="https://github.com/user-attachments/assets/6e0226b9-2724-4e0a-a8a5-b4eaf874eb6b" />

- 젬품 코드를 작성하는 동한 테스트를 계속 실행해야 한다.
    - 테스트를 반복 실행하면서 진행 상태를 확인하고, 시스템이 테스트 범위 밖에서 실패한다면 진단 정보를 통해 그 원인을 분석한다.
    - 필요한 경우 보조 코드를 확장·수정하여 오류 메시지가 더 명확하고 의미 있게 드러나도록 개선해야 한다.
- 오류 메시지를 검사해야 하는 이유
    - 현재 작성 중인 코드에 대한 가정이 맞는지 검증할 수 있다.
    - 테스트와 그 실패 메시지는 의도의 표현을 강조하는 것은 신뢰성 있고 유지하기 쉬운 시스템을 개발하는 데 핵심적인 역할을 한다.
- 유용한 진단 정보는 코드에서 해야 할 일이 무엇인지 분명하게 하는 데 도움이 된다.

## 5.6 입력에서 출력 순서로 개발하라

- 새로운 기능을 개발할 때, 행위를 일으키게 하는 이벤트부터 고려한다.
    - 전 구간 테스트는 해당 기능을 트리거(trigger) 하는 이벤트로부터 시작한다.
    - 시스템 경계에서는 이 이벤트를 처리하기 위해 여러 객체를 작성해야 한다.
    - 그 과정에서 자신이 의존하는 내부 서비스나 도메인 객체의 필요성이 드러나게 된다.
- 기능 구현의 흐름
    - 이벤트를 받는 객체 -> 중간 서비스 계층 -> 도메인 모델 -> 응답을 생성하는 객체
- 도메인 모델 객체의 단위 테스트부터 시작한다면 고립된 설계를 할 가능성이 높다.
    - 나중에 실제 시스템의 흐름과 연결될 때 통합 문제가 발생하기 쉽다.
    - 도메인 모델을 작업에 대한 피드백을 받을 수 없기 때문에 불필요하거나 잘못된 기능을 구현하며 시간을 낭비할 위험이 크다.

## 5.7 메서드가 아닌 행위를 단위 테스트하라

- 메서드를 테스트하는 것은 ‘무엇을 하는지’만 말해줄 뿐, 목적은 알려주지 않는다.
    - 시간이 지나면 해당 테스트의 목적이 무엇인지 이해하기 어려워진다.
- 테스트 대상 객체의 기능에 집중해야 한다.
    - 객체의 책임(responsibility)과 협력(collaboration)을 중심으로 테스트해야 한다.
    - 여러 메서드가 함께 작동하거나, 협력 객체를 호출해야 하는 경우라도 각 메서드의 내부 동작이 아니라, 해당 클래스가 달성해야 하는 목표를 검증해야 한다.
- 테스트 이름은 객체가 어떻게 동작하는지를 표현해야 한다.

> API 기능이 아닌 행위를 기술하는 것의 중요성
> - 메서드를 대상으로 한 테스트는 개별 동작만 검증할 뿐, 객체가 책임을 수행하는 과정에서 여러 메서드가 함께 어떻게 협력하는지를 보여주지 못한다.
> - 반면 행위 중심의 테스트는 객체가 시스템 내에서 어떤 역할을 수행하는지를 드러내며, 이해하기 쉽다.

## 5.8 테스트에 귀를 기울이라

- 테스트 작성이 어렵다면 설계 개선이 필요하다는 신호다.
    - 코드가 지나치게 결합되어 있거나, 책임이 명확히 분리되지 않았다는 징후다.
- 테스트를 작성하는 과정은 설계 문제를 조기에 알려주는 경보로, 그 힌트를 이용해 문제가 심각하지 않을 때 개선해야 한다.
- “예상치 못한 변화를 예상하라”
    - 설계가 견고하고 유연하다면, 요구사항의 변경이나 기능 추가가 있어도 쉽게 대응할 수 있다.
    - 테스트를 통해 설계의 약점을 인식하고, 지속적인 리팩터링으로 시스템의 내부 품질을 유지해야 한다.

## 5.9 주기의 미세 조정

- 단위 테스트와 통합 테스트 사이에는 균형을 이루는 지점이 존재한다.
    - 너무 큰 단위의 테스트는 모든 분기를 시도하는 조합 폭발(combinatorial explosion) 현상으로 개발이 중단될 수 있다.
    - 분기 가운데 일부는 해당 수준에서 테스트하기에 적합하지 않다.
    - 반대로 테스트 단위를 세분화하면, 테스트하기는 쉽지만 객체 간 협력에서 발생하는 문제를 놓칠 수 있다.
- 단위 테스트와 통합 테스트의 비율에 정답은 없다.
- TDD를 통해 얻을 수 있는 가장 큰 이점은 코드를 망가뜨리지 않고 변경할 수 있다는 자신감이다.
- 주기적으로 TDD가 얼마나 도움이 되는지 되짚어보고, 취약점을 찾아 테스트 전략을 조정해야 한다.
