# 4장 테스트 주도 주기 시작

- 테스트는 인수 테스트의 일환으로 전 구간을 대상으로 피드백을 제공해야 한다.
    - 외부 인터페이스 -> 빌드 -> 배포 -> 테스트 실행까지 준비해야 할 작업이 많다.
    - 시스템이 어떤 식으로 현실과 결부될지 이해한다면, 가늠조차 할 수 없는 기술적·조직적 위험이 드러난다.
- 피드백은 근본적인 도구로, 올바른 방향으로 나아가고 있는지 미리 파악하는 역할을 한다.
- 적절한 지점에서 첫 테스트를 시작한다면 이후의 테스트는 훨씬 효율적으로 작성할 수 있다.

## 4.1 우선 동작하는 골격을 대상으로 테스트하라

- 첫 인수 테스트를 작성하고 통과시키는 작업이 어려운 이유
    - 도구를 마련해야 한다.
    - 동시에 마련한 도구로 테스트 하며 기능까지 구현해야 한다.
- '최초 기능의 역설(The Paradox of the First Feature)'은 규모가 작은 두 단계로 나누면 해결할 수 있다.
    - 동작하는 골격을 만든다.
    - 기반 구조를 바탕으로 천 번째 유의미한 테스를 작성한다.
    - 그 후에는 테스트 주도 개발(TDD)를 진행할 수 있는 기반이 갖춰진다.
- 동작하는 골격(Working Skeleton)
    - 전 구간을 자동 빌드 -> 배포 -> 테스트할 수 있는 최소한의 구현 구조를 의미한다.
        - 완전한 기능은 없더라도 전 구간이 연결되어 피드백을 줄 수 있는 얇은 수직 조각(thin vertical slice)
    - 첫 기능을 작성할 수 있을 정도의 자동화, 주요 컴포넌트, 통신 메커니즘이 포함된다.
    - 애플리케이션 기능이 최소화되어 있어, 구조적 문제에만 집중할 수 있다.
    - '전 구간'은 시스템뿐만 아니라 프로세스를 포함한다.
- 테스트 과정에 배포 단계를 포함해야 하는 이유
    - 배포 단계는 손수 해서는 안될 오류가 발생하기 쉬운 과정이다.
        - 수동 배포를 진행하면, 실수나 환경 의존적인 문제로 인해 장애가 발생할 위험이 높다.
        - 스크립트는 실제 환경에 배포하기 전에 철저하게 검증해야 한다.
    - 배포 단계는 프로세스 학습할 수 있는 과정이다.
        - 배포 단계에서는 개발 팀이 조직의 다른 부문과 접촉하기도 하며, 운영이 실제로 어떻게 되는지도 배울 수 있다.
- 전 구간을 대상으로 수행되는 테스트 달성이 어렵다면 현재 알고 있는 수준에서 가능한 기반 구조부터 시작해야 한다.
    - 임시 기반 구조에는 잠재적 위험이 내재한다.
- 동작하는 골격과 보조하는 기반 구조는 테스트 주도 개발(TDD)을 시작하는 방법을 도와주기 위해 존재한다.

## 4.2 동작하는 골격의 외형 결정

- '동작하는 골격'을 개발한다는 것은 애플리케이션의 개발적인 구조를 결정하기 시작한다는 의미다.
- 초기 구조를 설계하려면, 시스템의 목적을 어느정도 이해해야 한다.
- 이러한 결정을 내릴 때는 클라이언트의 요구 사항을 고수준 관점에서 바라봐야 한다.
    - 기능적 요구사항(무엇을 해야 하는가)뿐만 아니라 비기능적 요구사항(어떤 제약 속에서 동작해야 하는가)도 함께 고려해야 한다.
- 동작하는 골격의 핵심
    - 첫 테스트를 작성하는 과정을 통해 프로젝트의 맥락을 파악하는 데 있다.
        - 기능을 구현하기 전에 취해야 할 의사 결정을 자연스럽게 탐색하는 과정이다.
    - 완전한 설계가 목표가 아니다.
        - 정교한 수준의 전체 설계가 아니라, TDD 주기를 시작하는 데 필요한 최소한의 의사 결정을 내리는 출발점이 된다.

<img width="1340" height="270" alt="Image" src="https://github.com/user-attachments/assets/3b7504ad-c9d7-41d8-bfd2-0367ded9b085" />

## 4.3 피드백 소스 구축

- 애플리케이션 설계 과정에서 내리는 의사결정이나 가정은 확실하지 않다.
    - 개발 과정에서 피드백을 통해 의사결정과 가정이 옳은지 검증해야 한다.
    - '동작하는 골격'을 구현하고자 제작한 도구는 학습과 피드백 과정을 지원하는 기반 구조가 된다.
- 빌드 및 테스트 자동화는 시스템 품질에 관한 피드백을 제공한다.
- 자동화된 배포는 시스템을 자주 출시하는 데 도움이 된다.
    - 시스템을 자주 출시하면 도메인에 대한 가설을 빠르게 검증할 수 있고, 그 결과 우리가 도메인을 얼마나 올바르게 이해하고 있는지에 대한 피드백을 얻을 수 있다.
    - 실제로 출시된 시스템을 사용하는 사용자를 관찰하면, 가정이 아닌 실제 사용자의 관심사와 우선순위가 드러나며, 이를 통해 개발 방향과 우선순위에 대한 피드백을 받을 수 있다.
- 피드백의 진정한 가치는 무엇을 배우든, 그 학습에 따라 시스템을 바꿀 수 있다는 점이다.
    - 테스트를 먼저 작성하면 회귀 테스트 세트(regression suite) 모음을 갖게 된다.
    - 테스트 모음은 중대한 변경에도 기존 기능이 깨지지 않음을 보장하는 안전망이 된다.

## 4.4 불확실성은 일찍 드러내라

- ‘동작하는 골격’을 실제로 작동하게 만들기까지는 많은 시간이 걸린다.
    - 기반 구조를 다지고, 복잡한 질문을 던지고 답하는 작업을 거치게 된다.
- 기능 요구사항과 대상 환경에 대해 더 많이 이해할수록, 오히려 일부 기능을 구현하는 데 걸리는 시간을 예측하기 어려워진다.
    - 드러난 모든 요소(의존성, 제약 등)들이 불확실성을 높인다.
- 시스템 통합 시점이 뒤로 갈수록 예츨 불가능에 가까워진다.
    - 제한된 시간 안에 모든 문제를 해결해야 한다.
    - 프로젝트 후반부로 갈수록 불안정성이 높아진다.
- 테스트 주도 개발은 불확실성을 관리하는 효과적인 도구다.
    - 피드백 루프를 통해 방향 감각을 확보하고, 가정을 테스트할 구체적인 구현을 갖추게 해준다.

  <img width="500" height="300" alt="Image" src="https://github.com/user-attachments/assets/c20736d1-d521-46a5-838f-4003b446f6e9" />

> 기존 시스템을 대상으로 한 개발
>
> - 기존 시스템을 가지고 있는 경우 '동작하는 골격'을 만드는 것으로 프로젝트를 시작할 수 없다.
> - 그러나 기존 시스템에 TDD를 적용하는 원칙은 근본적으로 다르지 않다.
>   1. 빌드 및 배포 과정을 자동화한다.
>   2. 변경하고자 하는 코드 영역을 포괄하는 전 구간 테스트(End-to-End Test)를 추가한다.
>   3. 그 위에서 새로운 기능을 추가하고, 점진적으로 리팩터링 및 단위 테스트를 도입한다.
> - 전 구간 테스트 기반 구조를 구축하는 가장 쉬운 방법은 시스템이 정상적으로 동작하는 단순한 경로(happy path)를 이용하는 것이다.
> - 더 어려운 문제를 다루기에 전, 보조적인 성격의 기반 구조를 만들어낼 수 있다.
